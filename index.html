<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MONTREAL DUTY FREE — Cash Counter</title>

  <!-- Cache-busted assets -->
  <link rel="stylesheet" href="styles.css?v=20250814-4" />
</head>
<body>
  <header class="app-header">
    <div class="branding-left">
      <!-- Help (far left) -->
      <button id="helpBtn" class="btn ghost">Help</button>

      <div class="branding">
        <div class="logo-image">
          <img src="montreallogo.png" alt="Montreal Duty Free Logo">
        </div>
        <div>
          <h1>MONTREAL DUTY FREE</h1>
          <p class="subtitle">AerRianta Intl NA</p>
        </div>
      </div>

      <div class="header-actions">
        <button id="contrastToggle" class="btn ghost" aria-pressed="false">High Contrast</button>
        <button id="langToggle" class="btn ghost">FR</button>
        <button id="printBtn" class="btn secondary">Print</button>
        <button id="openSharePointBtn" class="btn sharepoint">Open SharePoint Folder</button>
      </div>
    </div>
  </header>

  <!-- Live region for small status/validation updates -->
  <div id="statusLive" class="sr-only" aria-live="polite"></div>

  <main class="container">
    <!-- Session Info -->
    <section class="card" aria-labelledby="sessionTitle">
      <h2 id="sessionTitle">Session Info</h2>
      <div class="grid">
        <label class="field" id="f-cashierName">
          <span>Head Cashier/Manager Name</span>
          <input id="cashierName" type="text" placeholder="Your full name" aria-describedby="err-cashierName" />
          <small id="err-cashierName" class="error" aria-hidden="true"></small>
        </label>
        <label class="field" id="f-countDate">
          <span>Date</span>
          <input id="countDate" type="date" aria-describedby="err-countDate" />
          <small id="err-countDate" class="error" aria-hidden="true"></small>
        </label>
        <label class="field">
          <span>Store</span>
          <select id="store">
            <option>International</option>
            <option>Transborder</option>
            <option>Jetty</option>
            <option>Value</option> <!-- matches SharePoint folder -->
          </select>
        </label>
        <label class="field">
          <span>Cashiers (who used the cash)</span>
          <input id="cashiersList" type="text" placeholder="Comma-separated e.g., Samira, Alex" />
        </label>
        <label class="field">
          <span>Cash Number</span>
          <input id="cashNumber" type="text" placeholder="e.g., Cash #1" />
        </label>
      </div>
    </section>

    <!-- Denominations -->
    <section class="card" aria-labelledby="denomsTitle">
      <div class="card-header">
        <h2 id="denomsTitle">Denominations</h2>
        <div class="row gap">
          <label class="toggle"><input type="checkbox" id="enableCAD" checked> <span>CAD</span></label>
          <label class="toggle"><input type="checkbox" id="enableUSD"> <span>USD</span></label>
          <label class="toggle"><input type="checkbox" id="enableEUR"> <span>EUR</span></label>
        </div>
      </div>
      <div id="denomSections" class="denom-wrapper"></div>
      <small class="hint">Quantities must be between 0 and 10,000.</small>
    </section>

    <!-- Totals -->
    <section class="card" aria-labelledby="totalsTitle">
      <h2 id="totalsTitle">Totals</h2>
      <div class="totals-grid">
        <!-- CAD -->
        <div class="tot">
          <span>CAD Counted</span>
          <strong id="cadTotal">0.00</strong>
          <label class="field compact">
            <span>CAD Reported (Z report)</span>
            <input id="reportedCAD" type="number" step="0.01" placeholder="0.00" />
          </label>

          <!-- NEW: Lost Change CAD -->
          <label class="field compact">
            <span>CAD Lost Change (&lt; $5)</span>
            <input id="lostChangeCAD" type="number" step="0.01" placeholder="0.00" />
          </label>

          <div class="field compact">
            <span>CAD Difference</span>
            <strong id="cadDiff" class="diff">0.00</strong>
          </div>
        </div>

        <!-- USD -->
        <div class="tot">
          <span>USD Counted</span>
          <strong id="usdTotal">0.00</strong>
          <label class="field compact">
            <span>USD Reported (Z report)</span>
            <input id="reportedUSD" type="number" step="0.01" placeholder="0.00" />
          </label>
          <div class="field compact">
            <span>USD Difference</span>
            <strong id="usdDiff" class="diff">0.00</strong>
          </div>
        </div>

        <!-- EUR -->
        <div class="tot">
          <span>EUR Counted</span>
          <strong id="eurTotal">0.00</strong>
          <label class="field compact">
            <span>EUR Reported (Z report)</span>
            <input id="reportedEUR" type="number" step="0.01" placeholder="0.00" />
          </label>
          <div class="field compact">
            <span>EUR Difference</span>
            <strong id="eurDiff" class="diff">0.00</strong>
          </div>
        </div>

        <!-- Card Difference (optional info) -->
        <div class="tot">
          <label class="field compact">
            <span>Card Difference (info only)</span>
            <input id="cardDifference" type="number" step="0.01" placeholder="0.00" />
          </label>
        </div>

        <!-- Reconciled Difference -->
        <div class="tot">
          <span>Reconciled Difference (CAD + USD + EUR)</span>
          <strong id="recDiff" class="diff">0.00</strong>
        </div>
      </div>
    </section>

    <!-- Deposits (list with edit/delete) -->
    <section class="card" aria-labelledby="depositsTitle">
      <div class="card-header">
        <h2 id="depositsTitle">Deposits</h2>
        <div class="row right">
          <button id="depositBtn" class="btn">+ Deposit</button>
        </div>
      </div>
      <div id="depositsList" class="deposits-list empty" aria-live="polite"></div>
    </section>

    <!-- Actions -->
    <section class="card actions">
      <button id="resetBtn" class="btn danger">Reset</button>
      <button id="exportCsvBtn" class="btn" disabled>Export CSV</button>
      <button id="exportPdfBtn" class="btn primary" disabled>Export PDF</button>
      <button id="openSharePointBtn2" class="btn sharepoint">Open SharePoint Folder</button>
    </section>

    <!-- Sticky summary -->
    <div class="sticky-summary" aria-live="polite">
      <div><strong>Total Counted:</strong> <span id="summaryCounted">0.00</span></div>
      <div><strong>Reconciled Difference:</strong> <span id="summaryRecDiff">0.00</span></div>
    </div>
  </main>

  <footer class="footer">
    <small>© <span id="year"></span> MONTREAL DUTY FREE — Internal tool prototype · v2025.08.14-1</small>
  </footer>

  <!-- Help Modal -->
  <div id="helpModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="helpTitle" aria-modal="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-panel" role="document" tabindex="-1">
      <header class="modal-header">
        <h3 id="helpTitle">How to use this app</h3>
        <button id="helpClose" class="btn ghost small" aria-label="Close help">✕</button>
      </header>
      <div class="modal-body">
        <ol id="helpList" class="help-steps"></ol>
      </div>
      <footer class="modal-footer">
        <button id="helpOk" class="btn primary">Got it</button>
      </footer>
    </div>
  </div>

  <!-- Deposit Modal (create/edit) -->
  <div id="depositModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="depositTitle" aria-modal="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-panel" role="document" tabindex="-1">
      <header class="modal-header">
        <h3 id="depositTitle">Add Deposit</h3>
        <button id="depositClose" class="btn ghost small" aria-label="Close deposit">✕</button>
      </header>
      <div class="modal-body">
        <div class="grid">
          <label class="field">
            <span id="lblDepCAD">CAD amount</span>
            <input id="depCAD" type="number" step="0.01" placeholder="0.00" />
          </label>
          <label class="field">
            <span id="lblDepUSD">USD amount</span>
            <input id="depUSD" type="number" step="0.01" placeholder="0.00" />
          </label>
          <label class="field">
            <span id="lblDepEUR">EUR amount</span>
            <input id="depEUR" type="number" step="0.01" placeholder="0.00" />
          </label>
          <label class="field" style="grid-column:1/-1">
            <span id="lblDepNote">Optional note (e.g., Mid-day drop, bag #)</span>
            <input id="depNote" type="text" placeholder="Note" />
          </label>
        </div>
      </div>
      <footer class="modal-footer">
        <button id="depositSave" class="btn primary">Save</button>
      </footer>
    </div>
  </div>

  <!-- Cache-busted JS -->
  <script src="app.js?v=20250814-1"></script>
</body>
</html>
